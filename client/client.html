<!DOCTYPE html>
<html lang="en">
<head>
  <title>Our simple HTTP server</title>
  <link rel="stylesheet" type="text/css" href="/style.css">
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js"></script>
  <script type="text/babel">
    //function to parse our response
    const parseJSON = (xhr, content) => {
      //parse response (obj will be empty in a 204 updated)
      const obj = JSON.parse(xhr.response);
      console.dir(obj);
      
      //if message in response, add to screen
      // if(obj.message) {
      //   const p = document.createElement('p');
      //   p.textContent = `Message: ${obj.message}`;
      //   content.appendChild(p);
      // }
      
      //if users in response, add to screen
      if(obj.users) {
<<<<<<< HEAD
        // const userList = document.createElement('p');
        // const users = JSON.stringify(obj.users);
        // userList.textContent = users;
        // content.appendChild(userList);
        content.innerHTML = '';
        for(let key in obj.users){
          console.log("outside");
          if(obj.users.hasOwnProperty(key)){
            console.log("inside");
            const div = document.createElement('div');
            const gameName = document.createElement('p');
            console.log(key);
            console.log(obj.users[key]);
            gameName.innerHTML = `<p>Game: ${obj.users[key].game}</p>`;
            div.appendChild(gameName);
            content.appendChild(div);
          }
          
        }
=======
        const userList = document.createElement('p');
        const users = JSON.stringify(obj.users);//check by the [key]
        userList.textContent = users;
        content.appendChild(userList);
        //for each key in object.users{ object.users[key].raid}
>>>>>>> 3f4c5aa9a774a56f29466942bb8aa15196c10e8b

      }
    };
    //function to handle our response
    const handleResponse = (xhr,parseResponse) => {
      const content = document.querySelector('#content');
<<<<<<< HEAD
      
      // //check the status code
      // switch(xhr.status) {
      //   case 200: //success
      //     content.innerHTML = `<b>Success</b>`;
      //     break;
      //   case 201: //created
      //     content.innerHTML = '<b>Create</b>';
      //     break;
      //   case 204: //updated (no response back from server)
      //     content.innerHTML = '<b>Updated (No Content)</b>';
      //     return;
      //   case 400: //bad request
      //     content.innerHTML = `<b>Bad Request</b>`;
      //     break;
      //   case 404: //bad request
      //   content.innerHTML = `<b>Resource Not Found</b>`;
      //     break;
      //   default: //any other status code
      //     content.innerHTML = `Error code not implemented by client.`;
      //     break;
      // }
=======
      const response = JSON.parse(xhr.response);
      //check the status code
      switch(xhr.status) {
        case 200: //success
          content.innerHTML = `<b>Success</b>`;
          break;
        case 201: //created
          content.innerHTML = '<b>Create</b>';
          break;
        case 204: //updated (no response back from server)
          content.innerHTML = '<b>Updated (No Content)</b>';
          return;
        case 400: //bad request
          content.innerHTML = `<b>Bad Request</b>`;
          break;
        case 404: //bad request
        content.innerHTML = `<b>Resource Not Found</b>`;
          break;
        default: //any other status code
          content.innerHTML = `Error code not implemented by client.`;
          break;
      }
>>>>>>> 3f4c5aa9a774a56f29466942bb8aa15196c10e8b
      
        if(xhr.status != 204 && parseResponse){
            // parseJSON(xhr, content);
            console.log(response.users)
        }
        
        else{
            console.log('received')
        }
    };
    
    const sendPost = (e, nameForm) => {//add debug
      
      const nameAction = nameForm.getAttribute('action');
      const nameMethod = nameForm.getAttribute('method');
      
      
      const gameField = nameForm.querySelector('#gameField');
      const maxPlayer = nameForm.querySelector('#maxPlayer');
      const raid = nameForm.querySelector('#raidField');
      
      
      const xhr = new XMLHttpRequest();
      
      xhr.open(nameMethod, nameAction);

      xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
      
      xhr.setRequestHeader ('Accept', 'application/json');
      
      xhr.onload = () => handleResponse(xhr,true);
      console.log(gameField.value + " " + maxPlayer.value + " " + raid.value);
      const formData = `game=${gameField.value}&maxP=${maxPlayer.value}&raid=${raid.value}`;

      xhr.send(formData);
      e.preventDefault();
      return false;
    };
    const sendGet = (e, nameForm) => {
      const userMethod = userForm.getAttribute('method');
      const urlField = userForm.querySelector('#urlField');
      const methodSelect = userForm.querySelector('#methodSelect');
      const xhr = new XMLHttpRequest();
      xhr.open(methodSelect.value, urlField.value);
      if(methodSelect.value === 'get'){
        xhr.onload = () => handleResponse(xhr, true);
      } else {
        xhr.onload = () => handleResponse(xhr, false);
      }
      xhr.setRequestHeader ('Accept', 'application/json');
      xhr.send();
        
      e.preventDefault();
        
      return false;
    }
    const init = () => {//add debug
      const nameForm = document.querySelector('#nameForm');
      
      const addUser = (e) => sendPost(e, nameForm);
      
      nameForm.addEventListener('submit', addUser);
      const userForm = document.querySelector('#userForm');
      const getUser = (e) => sendGet(e, userForm);
      userForm.addEventListener('submit', getUser);
    };
    window.onload = init;
  </script>
</head>
<body>
  <svg id="logoAsset" data-name="logoAsset" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 722.53 1208.12"><defs><style>.cls-1{fill:#b1a7a1;}.cls-2{fill:#928b89;}.cls-3{fill:#29343e;}.cls-4{fill:#272626;stroke:#272626;stroke-width:2.07px;}.cls-4,.cls-6{stroke-miterlimit:10;}.cls-5{fill:#888381;}.cls-6{fill:#b4a8a2;stroke:#888381;stroke-width:1.35px;}.cls-7{fill:#010101;opacity:0.33;}</style></defs><title>Untitled-1</title><path class="cls-1" d="M521.46,322.38l31.83,613.2c10,273,49.31,273,49.31,273s35.52,0,44.17-273l31.83-613.2" transform="translate(-236.42 -12.88)"/><path class="cls-2" d="M579.7,326.13l8.24,417.08c2.58,185.72,12.76,185.72,12.76,185.72s9.19,0,11.43-185.72l8.23-417.08" transform="translate(-236.42 -12.88)"/><path class="cls-3" d="M567.86,99c-11.31,13.92-18.38,207.86-18.38,207.86H650.15S645.31,140.4,631.68,98.41C631.68,98.41,602.53,106.16,567.86,99Z" transform="translate(-236.42 -12.88)"/><path class="cls-1" d="M567.86,99a45.64,45.64,0,0,1-23.54-19c-7.69-12.61-7.39-27.27,0-40,5.35-9.2,14.88-19.31,31.7-23.92a84.22,84.22,0,0,1,21.6-3.21H602a84.36,84.36,0,0,1,21.61,3.21C640.5,20.72,650,30.91,655.38,40.14A38.83,38.83,0,0,1,655.31,80,35.45,35.45,0,0,1,652.57,84c-7.09,9-19,15.19-32.38,17.32C607.6,103.37,586.75,105.06,567.86,99Z" transform="translate(-236.42 -12.88)"/><path class="cls-4" d="M521.46,322.38s-.92-4.38-33.54-6.43c-12.64-.8-25.37,1.43-36.09,6.67a70.24,70.24,0,0,0-7.42,4.21,31.34,31.34,0,0,1-19.14,4.67c-3.71-.39-6.36-3.12-5.74-6,1-4.69,6.05-11.77,25.92-15.64,1-.19,2-.38,3-.59,4.07-.85,20.43-3.82,45.24-2.73,0,0,53.66,1.1,95.69-.24h21.26c42,1.34,95.69.24,95.69.24,24.73-1.09,41.06,1.86,45.21,2.72,1,.22,2.05.41,3.09.61,21.12,4.12,25.46,11.87,26,16.5.29,2.33-1.72,4.48-4.67,4.95A28.3,28.3,0,0,1,766,331a31.42,31.42,0,0,1-10.55-4.29,69.48,69.48,0,0,0-7-4c-10.81-5.32-23.68-7.55-36.44-6.74-32.44,2.06-33.36,6.42-33.36,6.42s-61.66,1.05-78.57,10.86C600,333.24,583.21,323.64,521.46,322.38Z" transform="translate(-236.42 -12.88)"/><path class="cls-5" d="M601.84,389.58S395.65,471,243.19,497.14c0,0-32.67,209.14,45.59,415.16,45.08,118.65,141.36,221.88,273.16,291.58,14.06,7.43,26.68,13.49,36.47,17.12,0,0,19.71-5.61,57.76-25.64,110.09-57.94,193-141.92,237.44-239.17,45.59-99.81,82.63-250.24,56.89-460C950.5,496.17,702.76,435.69,601.84,389.58Z" transform="translate(-236.42 -12.88)"/><path class="cls-6" d="M602.25,420.11s-191,75.42-332.31,99.66c0,0-30.28,193.78,42.24,384.67,41.77,109.94,131,205.59,253.1,270.17,13,6.89,24.73,12.5,33.79,15.86,0,0,18.26-5.2,53.52-23.76,102-53.68,178.84-131.49,220-221.6,42.24-92.48,76.57-231.86,52.72-426.24C925.31,518.87,695.76,462.83,602.25,420.11Z" transform="translate(-236.42 -12.88)"/><path class="cls-7" d="M875.41,938.39S959,773.58,925.31,518.87c0,0-239.95-59.11-322.93-98.19l-4.69,1.58v767.28l1.41.57S793.58,1123.26,875.41,938.39Z" transform="translate(-236.42 -12.88)"/><path class="cls-7" d="M598.41,1221s19.71-5.61,57.76-25.64q11.22-5.91,22.05-12.17A701.79,701.79,0,0,1,598.41,1221Z" transform="translate(-236.42 -12.88)"/><path class="cls-7" d="M620.36,327.76,618.93,397l-17.09-7.43c29.32,13.18,93,36.11,160.88,55.83-30.42-9-61.09-18.56-89.05-28.12l4.93-94.91S679.52,318,712,316c12.76-.81,25.63,1.42,36.44,6.74a69.48,69.48,0,0,1,7,4A31.34,31.34,0,0,0,766,331a28.3,28.3,0,0,0,10.06.38c3-.47,5-2.62,4.67-4.95-.57-4.63-4.91-12.38-26-16.5-1-.2-2.06-.39-3.09-.61-4.15-.86-20.48-3.81-45.21-2.72,0,0-35,.72-70.63.29h14.43S645.31,140.4,631.68,98.41h0c8.58-3.1,16-8,20.94-14.38A35.45,35.45,0,0,0,655.31,80a38.83,38.83,0,0,0,.07-39.85c-5.34-9.23-14.88-19.42-31.77-24A84.36,84.36,0,0,0,602,12.88h-4.31v320a21.06,21.06,0,0,1,2.38,1.13C606.26,330.06,620.36,327.76,620.36,327.76Z" transform="translate(-236.42 -12.88)"/></svg>
  <section id="top">
    <h3>POST Status Code Tests</h3>
    <form id="nameForm" action="/addUser" method="post">
      <label for="game">Game: </label>
      <input id="gameField" type="text" name="game" />
      <label for="raid">Raid: </label>
      <input id="raidField" type="text" name="raid" />
      <label for="maxP">Max Players: </label>
      <input id="maxPlayer" type="number" name="maxP" min="0" max="100" step="1"/>
      <input type="submit" value="Add User" />
    </form>
    <form id="userForm" action="/getUsers" method="get">
      <select id='urlField'>
        <option value='/getUsers'>/getUsers</option>
        <option value='/notReal'>/notReal</option>
      </select>
      <select id="methodSelect">
        <option value="get">GET</option>
        <option value="head">HEAD</option>
      </select>
      <input type="submit" value="send" />
    </form>
  </section>
  <section id="content">
  </section>
</body>
</html>